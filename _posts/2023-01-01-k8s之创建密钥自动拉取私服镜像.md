---
layout:     post
title:      k8s创建密钥拉取镜像
subtitle:   k8s创建密钥拉取镜像
date:       2023-01-01
author:     eddie
header-img: img/home-bg-o.jpg
catalog: true
tags:
    - k8s
---

# kubernetes实战篇之创建密钥自动拉取私服镜像


### 方式一：命令行基于现有docker登陆信息创建kubernetes密钥


####
&ensp; &ensp;&ensp;&ensp;   1. 必须先登录镜像仓库，然后执行如下命令
<br>
&ensp; &ensp;&ensp;&ensp;   2. 默认创建的secret名称空间为kube-system,可指定名称空间 -n namespace

```shell
kubectl create secret generic regcred --from-file=.dockerconfigjson= ~/.docker/config.json --type=kubernetes.io/dockerconfigjson
```

### **方式二：yml文件基于现有docker登陆信息创建kubernetes密钥**


####
&ensp; &ensp;&ensp;&ensp; 1. data字段的名称必须设置为.dockerconfigjson
<br>
&ensp; &ensp;&ensp;&ensp; 2. 对config.json文件进行base64编码,然后把编码后的内容复制到.dockerconfigjson字段
<br>
&ensp; &ensp;&ensp;&ensp; 3. 类型设置为kubernetes.io/dockerconfigjson
```shell
apiVersion: v1
kind: Secret
metadata:
  name: your-secret-name
  namespace: your-namespace
data:
  .dockerconfigjson: UmVhbGx5IHJlYWxseSByZWVlZWVlZWVlZWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGx5eXl5eXl5eXl5eXl5eXl5eXl5eSBsbGxsbGxsbGxsbGxsbG9vb29vb29vb29vb29vb29vb29vb29vb29vb25ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubmdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2cgYXV0aCBrZXlzCg==
type: kubernetes.io/dockerconfigjson
```

###  方式三：直接从命令行创建secret

####
&ensp; &ensp;&ensp;&ensp; 1. --docker-server 仓库地址，必填
<br>
&ensp; &ensp;&ensp;&ensp; 2. --docker-username 仓库登录用户, 必填
<br>
&ensp; &ensp;&ensp;&ensp; 3. --docker-password 仓库登录密码 ,必填
<br>
&ensp; &ensp;&ensp;&ensp; 4. --docker-email 仓库登录邮箱,非必填
<br>


```shell
kubectl create secret docker-registry regcred --docker-server=<your-registry-server> --docker-username=<your-name> --docker-password=<your-pword> --docker-email=<your-email>
```

## 查看密钥信息

```
kubectl get secret regcred --output=yaml
```
```
[centos@k8s-master trackingapi]$ kubectl get secret regcred --output=yaml
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyIxOTIuMTY4LjEyNC40Mzo4MDAyIjp7IlVzZXJuYW1lIjoiYWRtaW4iLCJQYXNzd29yZCI6ImFkbWluMTIzIiwiRW1haWwiOiIifX19
kind: Secret
metadata:
  creationTimestamp: "2019-04-12T05:53:19Z"
  name: regcred
  namespace: default
  resourceVersion: "3763835"
  selfLink: /api/v1/namespaces/default/secrets/regcred
  uid: 46028dd4-5ce7-11e9-bc12-0050568417a2
type: kubernetes.io/dockerconfigjson
```
其中.dockerconfigjson字段为docker的登陆信息,我们可以通过base64解码来查看它:
```
kubectl get secret regcred --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode
```
