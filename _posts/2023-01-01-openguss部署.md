---
layout:     post
title:       openguss的安装部署
subtitle:    openguss的安装部署
date:       2023-01-01
author:     eddie
header-img: img/home-bg-o.jpg
catalog: true
tags:
    - openguss
---


## 企业版部署 
企业版5.0单机版部署，参考官网配置要求



### 1. /etc/sysctl.conf修改为下面的参数

```shell
    net.ipv4.ip_local_port_range =26000 65535
    net.ipv4.tcp_retries1= 5
    net.ipv4.tcp_syn_retries=5
    net.ipv4.tcp_synack_retries=5

```


### 2. /etc/security/limits.conf修改为下面的参数
```shell
    * soft nofile 1000000
    * hard nofile 1000000
```

### 3. 关闭swapoff
```shell
    swapoff -a #关闭
    swapon -a 
```

### 4. 设置网卡MTU值 
```
    ifconfig ens192 mtu 8192
```

### 5. 关闭防火墙
```
    systemctl disable firewalld.service
    systemctl stop firewalld.service
```

### 6. 关闭selinux
```
    ##vim /etc/selinux/config 
    SELINUX=disabled
```
```
    setenforec 0
    getenforec
```

### 7. 修改大页
```
 echo 'never' > /sys/kernel/mm/transparent_hugepage/enabled
 echo 'never' > /sys/kernel/mm/transparent_hugepage/defrag 
 mkdir /etc/tuned/no-thp -p
 echo -e "[main]\ninclude=virtual-guest\n[vm]\ntransparent_hugepages=never" >/etc/tuned/no-thp/tuned.conf
 tuned-adm profile no-thp
```

### 8. 安装依赖包
```
yum install -y libaio-devel flex bison ncurses-devel glibc-devel patch lsb_release readline-devel expect bzip2 gcc openssl-devel zlib* libffi-devel
```

### 9. 安装python3环境
```
    cd /opt
    wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tgz
    tar -zxvf Python-3.6.6.tgz


    ##编译安装，进入到python包进行编译安装
    cd /opt/Python-3.6.6
    ./configure --prefix=/usr/local/python3  --enable-shared
    make&&make install

    ##启动，软连接快速启动
    ln -s /usr/local/python3/bin/python3 /usr/bin/python3
    ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3
```

### 10. 创建安装目录
```
    mkdir -p /opt/software/openGauss
    chmod 755 -R /opt/software
```

### 11. 下载安装包
```
https://space-index.sibeiyun.com/index/package/openGauss-5.0.2-CentOS-64bit-all.tar.gz
https://opengauss.org/zh/download/  ##官网

```

### 12. 安装包上传到/opt/software/openGauss
``` 
cd /opt/software/openGauss
wget --user yunwei --password yunwei https://space-index.sibeiyun.com/index/package/openGauss-5.0.2-CentOS-64bit-all.tar.gz
```

### 13. 上传配置文件cluster_config.xml到/opt/software/openGauss

vim cluster_config.xml
请按照实际情况修改如下内容

```
<?xml version="1.0" encoding="UTF-8"?>
<ROOT>
    <!-- openGauss整体信息 -->
    <CLUSTER>
        <!-- 数据库名称 -->
        <PARAM name="clusterName" value="dbCluster" />
        <!-- 数据库节点名称(hostname) -->
        <PARAM name="nodeNames" value="master" />
        <!-- 数据库安装目录-->
        <PARAM name="gaussdbAppPath" value="/opt/huawei/install/app" />
        <!-- 日志目录-->
        <PARAM name="gaussdbLogPath" value="/var/log/omm" />
        <!-- 临时文件目录-->
        <PARAM name="tmpMppdbPath" value="/opt/huawei/tmp" />
        <!-- 数据库工具目录-->
        <PARAM name="gaussdbToolPath" value="/opt/huawei/install/om" />
        <!-- 数据库core文件目录-->
        <PARAM name="corePath" value="/opt/huawei/corefile" />
        <!-- 节点IP，与数据库节点名称列表一一对应 -->
        <PARAM name="backIp1s" value="172.16.162.91"/> 
    </CLUSTER>
    <!-- 每台服务器上的节点部署信息 -->
    <DEVICELIST>
        <!-- 节点1上的部署信息 -->
        <DEVICE sn="master">
            <!-- 节点1的主机名称 -->
            <PARAM name="name" value="master"/>
            <!-- 节点1所在的AZ及AZ优先级 -->
            <PARAM name="azName" value="AZ1"/>
            <PARAM name="azPriority" value="1"/>
            <!-- 节点1的IP，如果服务器只有一个网卡可用，将backIP1和sshIP1配置成同一个IP -->
            <PARAM name="backIp1" value="172.16.162.91"/>
            <PARAM name="sshIp1" value="172.16.162.91"/>
               
	    <!--dbnode-->
	    <PARAM name="dataNum" value="1"/>
	    <PARAM name="dataPortBase" value="15400"/>
	    <PARAM name="dataNode1" value="/opt/huawei/install/data/dn"/>
            <PARAM name="dataNode1_syncNum" value="0"/>
        </DEVICE>
    </DEVICELIST>
</ROOT>
```

### 14. 解压文件

```
    tar -zxvfopenGauss-5.0.0-CentOS-64bit-all.tar.gz
    tar -zxvf  openGauss-x.x.x-openEuler-64bit-om.tar.gz

```

### 15. 预安装，根据提示进行安装
```
cd /opt/software/openGauss/script
./gs_preinstall -U omm -G dbgrp -X /opt/software/openGauss/cluster_config.xml
```

### 16. 安装
```
su omm
cd /opt/software/openGauss/script
gs_install -X /opt/software/openGauss/cluster_config.xml
gs_install -X /opt/software/openGauss/cluster_config.xml --gsinit-parameter="--locale=zh_CN.utf8
```
密码最少包含8个字符，最多包含16个字符。

### 17. 验证安装
```
su - omm
gs_om -t status
gsql -d postgres -p 15400
```

### 18. 配置远程连接,修改端口
```
vim /opt/huawei/install/data/dn/postgresql.conf
listen_addresses ='*'
port = 5432
 
vim /opt/huawei/install/data/dn/pg_hba.conf
host    all             all             0.0.0.0/0            md5
```

### 19. 重启服务
```
su - omm
gs_om -t start
gs_om -t stop
```

### 20. 创建账户
```
gsql -d postgres -p 5432 -r

CREATE USER user_pgloader WITH PASSWORD 'gauss_123';
GRANT ALL PRIVILEGES TO user_pgloader;
CREATE DATABASE user_pgloader OWNER user_pgloader;

```
